<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Burst {{ burst.burst_id }} – {{ burst.image }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      /* === SENTRA DARK THEME PALETTE === */
      --bg-body: #0b1121;
      --bg-card: #151e32;
      --bg-header: #0f172a;
      --text-main: #ffffff;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --border-color: #2d3748;
      --primary: #38bdf8;
      --primary-glow: rgba(56, 189, 248, 0.15);
      --danger: #ff5252;
      --warning: #fbbf24;
      --success: #4ade80;
      --code-font: 'JetBrains Mono', monospace;
    }

    body { 
      font-family: 'Inter', sans-serif; 
      margin: 0; 
      background-color: var(--bg-body); 
      color: var(--text-main); 
      font-size: 13px;
    }

    header { 
      background: var(--bg-header); 
      border-bottom: 1px solid var(--border-color); 
      padding: 16px 24px; 
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    header h1 { margin: 0; font-size: 18px; line-height: 1.3; }
    header .meta-link { font-size: 12px; color: var(--text-secondary); text-decoration: none; border-bottom: 1px dotted var(--text-secondary); }
    header .meta-link:hover { color: #fff; border-bottom-style: solid; }

    .container { max-width: 1400px; margin: 24px auto; padding: 0 24px; }

    h2 { 
      font-size: 14px; 
      color: var(--text-main); 
      margin: 32px 0 16px; 
      text-transform: uppercase; 
      letter-spacing: 0.05em; 
      border-bottom: 1px solid var(--border-color); 
      padding-bottom: 8px;
    }

    /* Cards/Panels */
    .panel {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }

    /* Key-Value Grids */
    .kv-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; }
    .kv-item label { display: block; font-size: 11px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; }
    .kv-item span { font-size: 16px; font-weight: 600; color: #fff; }
    .kv-item span.mono { font-family: var(--code-font); font-size: 13px; color: var(--primary); }

    /* Risk Score Badge */
    .risk-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: 700;
      font-size: 14px;
    }
    .risk-high { background: rgba(255, 82, 82, 0.2); color: var(--danger); border: 1px solid var(--danger); }
    .risk-med { background: rgba(251, 191, 36, 0.2); color: var(--warning); border: 1px solid var(--warning); }
    .risk-low { background: rgba(74, 222, 128, 0.2); color: var(--success); border: 1px solid var(--success); }

    /* Tables */
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th { text-align: left; padding: 12px; color: var(--text-muted); border-bottom: 1px solid var(--border-color); font-weight: 600; text-transform: uppercase; font-size: 11px; }
    td { padding: 12px; border-bottom: 1px solid var(--border-color); color: var(--text-secondary); vertical-align: top; }
    tbody tr:hover { background: rgba(255,255,255,0.03); }
    td.mono { font-family: var(--code-font); font-size: 11px; }
    td.wrap { word-break: break-all; max-width: 400px; }

    /* Tags */
    .tag { padding: 2px 6px; border-radius: 4px; background: var(--bg-body); border: 1px solid var(--border-color); font-size: 10px; margin-right: 4px; display: inline-block; margin-bottom: 2px;}
  </style>
</head>
<body>

<header>
  <h1>
    <span style="display:block; font-size:12px; color:var(--text-muted); text-transform:uppercase; font-weight:600; letter-spacing:0.5px;">
      {% if burst.burst_type == "attack" %}Attack Candidate
      {% elif burst.burst_type == "baseline_deviation" %}Baseline Deviation
      {% else %}Burst Analysis{% endif %}
    </span>
    <span style="color:#fff;">{{ burst.image }}</span>
    <span style="color:var(--text-muted); font-weight:400;"> · {{ burst.burst_id }}</span>
  </h1>
  <a href="{{ url_for('dashboard') }}" class="meta-link">← Back to Dashboard</a>
</header>

<div class="container">

  <div class="panel">
    <div class="kv-grid">
      
      <div class="kv-item">
        <label>Burst ID</label>
        <span class="mono" style="color: #fff; font-size: 14px;">{{ burst.burst_id }}</span>
      </div>

      <div class="kv-item">
        <label>Time Window</label>
        <span class="mono">{{ burst.start_time }}<br>to {{ burst.end_time }}</span>
      </div>
      
      <div class="kv-item">
        <label>Kill Chain Stage</label>
        <span style="color: var(--primary);">{{ burst.kill_chain_stage }}</span>
      </div>
      
      <div class="kv-item">
        <label>Event Volume</label>
        <span>{{ burst.count }} events</span>
      </div>
      
      <div class="kv-item">
        <label>Calculated Risk Score</label>
        {% if burst.risk_score >= 60 %}
          <span class="risk-badge risk-high">{{ burst.risk_score }}/100 (High)</span>
        {% elif burst.risk_score >= 30 %}
          <span class="risk-badge risk-med">{{ burst.risk_score }}/100 (Medium)</span>
        {% else %}
          <span class="risk-badge risk-low">{{ burst.risk_score }}/100 (Low)</span>
        {% endif %}

        {% if burst.confidence_reasons %}
          <div style="margin-top: 12px; font-size: 11px; color: var(--text-muted); border-top: 1px solid var(--border-color); padding-top: 8px;">
            {% for r in burst.confidence_reasons %}
              <div style="margin-bottom: 4px; line-height: 1.4;">• {{ r }}</div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    
    </div>
  </div>

  <div class="panel">
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 32px;">
      
      <div>
        <h3 style="margin:0 0 12px 0; font-size:12px; color:var(--text-muted); text-transform:uppercase;">
            {% if burst.burst_type == "attack" %}Parent Image (Attack Vector)
            {% else %}Parent Image (Context){% endif %}
        </h3>
        {% if process_summary.parents %}
          {% for p in process_summary.parents %}
            <div style="font-family:var(--code-font); color:var(--primary); margin-bottom:4px;">
              {{ p }}
            </div>
          {% endfor %}
        {% else %}
          <span style="color:var(--text-secondary); font-style:italic;">None observed within window</span>
        {% endif %}
      </div>

      <div>
        <h3 style="margin:0 0 12px 0; font-size:12px; color:var(--text-muted); text-transform:uppercase;">
            {% if burst.burst_type == "attack" %}Spawned Children (Next Stage)
            {% else %}Spawned Children (Activity){% endif %}
        </h3>
        {% if process_summary.children %}
          {% for c in process_summary.children %}
            <div style="font-family:var(--code-font); color:var(--warning); margin-bottom:4px;">
              ↳ {{ c }}
            </div>
          {% endfor %}
        {% else %}
          <span style="color:var(--text-secondary); opacity:0.6;">No child processes spawned</span>
        {% endif %}
      </div>

    </div>
  </div>

  <h2>Event Timeline</h2>
  <div class="panel" style="padding:0;">
    {% if events %}
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>ID</th>
          <th>Parent</th>
          <th>CommandLine / Target</th>
          <th>Net / User</th>
        </tr>
      </thead>
      <tbody>
        {% for e in events %}
        <tr>
          <td class="mono" style="white-space:nowrap;">{{ e.event_time }}</td>
          <td>
            <span class="tag">{{ e.event_id }}</span>
            {% if e.dst_ip %}
                <span class="tag" style="color:var(--warning); border-color:rgba(251, 191, 36, 0.3);">NET</span>
            {% endif %}
            {% if e.file_path %}
                <span class="tag" style="color:var(--primary); border-color:rgba(56, 189, 248, 0.3);">FILE</span>
            {% endif %}
          </td>
          <td class="mono" style="color:var(--text-muted);">{{ e.parent_image or '-' }}</td>
          <td class="wrap mono">
            {% if e.command_line %}
              <div style="color:#fff;">{{ e.command_line }}</div>
            {% endif %}
            {% if e.file_path %}
              <div style="color:var(--text-muted); margin-top:4px;">File: {{ e.file_path }}</div>
            {% endif %}
          </td>
          <td>
            {% if e.dst_ip %}
              <div style="color:var(--warning);">{{ e.dst_ip }}:{{ e.dst_port }}</div>
              <div style="font-size:10px; color:var(--text-muted);">Src: {{ e.src_ip }}</div>
            {% endif %}
            {% if e.user %}
              <div style="margin-top:4px;">{{ e.user }}</div>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <div style="padding:24px; text-align:center; color:var(--text-muted);">No events found for this burst window.</div>
    {% endif %}
  </div>

</div>
</body>
</html>